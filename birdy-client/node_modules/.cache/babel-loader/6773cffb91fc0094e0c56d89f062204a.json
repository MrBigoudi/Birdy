{"ast":null,"code":"import _asyncToGenerator from\"/home/mrbigoudi/Documents/Projects/Birdy/birdy-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/mrbigoudi/Documents/Projects/Birdy/birdy-client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/mrbigoudi/Documents/Projects/Birdy/birdy-client/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState}from\"react\";import AutoLink from\"react-native-autolink\";import{useNavigate}from\"react-router-dom\";import axios from\"axios\";import moment from\"moment\";import CustomLink from\"../../atomComponents/CustomLink.js\";import TweetIcon from\"./TweetIcon.js\";import COMMENT_ICON from\"../../images/icons/tweetIcons/outline_chat_bubble_outline_white_18dp_1x.png\";import RETWEET_ICON from\"../../images/icons/tweetIcons/outline_reply_white_18dp_1x.png\";import LIKE_ICON from\"../../images/icons/tweetIcons/outline_favorite_border_white_18dp_1x.png\";import SHARE_ICON from\"../../images/icons/tweetIcons/outline_file_upload_white_18dp_1x.png\";import DEFAULT_PP from\"../../images/icons/outline_account_circle_white_36dp_2x.png\";import\"../../stylesheets/components/tweet.css\";//a tweet as a prop\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function Tweet(props){//const [nbReplies, setNbReplies] = useState([props.tweet['nbComments'], false]);\nvar nbReplies=props.tweet['nbComments'];var _useState=useState([props.tweet['nbRetweets'],false]),_useState2=_slicedToArray(_useState,2),nbRetweets=_useState2[0],setNbRetweets=_useState2[1];var _useState3=useState([props.tweet['nbLikes'],false]),_useState4=_slicedToArray(_useState3,2),nbLikes=_useState4[0],setNbLikes=_useState4[1];var _useState5=useState(props.deleted),_useState6=_slicedToArray(_useState5,2),deleted=_useState6[0],setDeleted=_useState6[1];var navigate=useNavigate();var _useState7=useState(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(\"/api/user/\".concat(props.tweet['author'])).then(function(res){//console.log('user: ', res.data);\nsetAuthor(res.data);});case 2:case\"end\":return _context.stop();}}},_callee);}))),_useState8=_slicedToArray(_useState7,2),author=_useState8[0],setAuthor=_useState8[1];function handleDelete(event){//console.log(\"handleDelete\");\nsetDeleted(function(prev){return!deleted;});return props.id;}// function handleReplyChange(event){\n//     setNbReplies( prev => {\n//         let replied = nbReplies[1]\n//         if(!replied)\n//             props.tweet.addReply();\n//         else\n//             props.tweet.removeReply();\n//         return [props.tweet.getNbReplies(), !replied];\n//     });\n// }\nfunction handleRetweetChange(_x){return _handleRetweetChange.apply(this,arguments);}function _handleRetweetChange(){_handleRetweetChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var userId,tweetId;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();//console.log('tweet: ', props.tweet);\nuserId=props.user['_id'];tweetId=props.tweet['_id'];// await Promise.all([\n//     axios\n//         .get(`/api/user/getUserId/${props.user['username']}`)\n//         .then( (res) => { userId = res.data; }),\n//     axios\n//         .post(\"/apiTweet/tweet/getTweetId\", props.tweet)\n//         .then( (res) => { tweetId = res.data; }),\n// ]);\n//console.log('tweetId: ', tweetId);\n//console.log('userId: ', userId);\n//console.log('retweeted? ', nbRetweets[1]);\nif(!nbRetweets[1]){axios.put(\"/api/user/\".concat(userId,\"/tweet/\").concat(tweetId,\"/retweet\")).then(function(){axios.get(\"/apiTweet/tweet/\".concat(tweetId)).then(function(res){//console.log('res last get: ', res);\nsetNbRetweets(function(prev){return[res.data['nbRetweets'],true];});});});}else{axios.put(\"/api/user/\".concat(userId,\"/tweet/\").concat(tweetId,\"/unretweet\")).then(function(){axios.get(\"/apiTweet/tweet/\".concat(tweetId)).then(function(res){//console.log('res last get: ', res);\nsetNbRetweets(function(prev){return[res.data['nbRetweets'],false];});});});}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return _handleRetweetChange.apply(this,arguments);}function handleLikeChange(_x2){return _handleLikeChange.apply(this,arguments);}function _handleLikeChange(){_handleLikeChange=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(event){var userId,tweetId;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:event.preventDefault();//console.log('tweet: ', props.tweet);\nuserId='';tweetId='';_context3.next=5;return Promise.all([axios.get(\"/api/user/getUserId/\".concat(props.user['username'])).then(function(res){userId=res.data;}),axios.post(\"/apiTweet/tweet/getTweetId\",props.tweet).then(function(res){tweetId=res.data;})]);case 5://console.log('tweetId: ', tweetId);\n//console.log('userId: ', userId);\n//console.log('liked? ', nbLikes[1]);\nif(!nbLikes[1]){axios.put(\"/api/user/\".concat(userId,\"/tweet/\").concat(tweetId,\"/like\")).then(function(){axios.get(\"/apiTweet/tweet/\".concat(tweetId)).then(function(res){//console.log('res last get: ', res);\nsetNbLikes(function(prev){return[res.data['nbLikes'],true];});});});}else{axios.put(\"/api/user/\".concat(userId,\"/tweet/\").concat(tweetId,\"/unlike\")).then(function(){axios.get(\"/apiTweet/tweet/\".concat(tweetId)).then(function(res){//console.log('res last get: ', res);\nsetNbLikes(function(prev){return[res.data['nbLikes'],false];});});});}case 6:case\"end\":return _context3.stop();}}},_callee3);}));return _handleLikeChange.apply(this,arguments);}function handleCheckUserPage(_x3){return _handleCheckUserPage.apply(this,arguments);}function _handleCheckUserPage(){_handleCheckUserPage=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(event){var userId,author;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:event.preventDefault();//console.log('tweet: ', props.tweet);\nuserId=props.user['_id'];/*\n        await axios\n                .get(`/api/user/getUserId/${props.user['username']}`)\n                .then( (res) => { userId = res.data; });\n        */author=props.tweet['author'];//console.log('test handle check user page');\nif(author!==userId){navigate(\"/p/\".concat(userId),{state:{alreadyLogged:true,userId:author},replace:false});}case 4:case\"end\":return _context4.stop();}}},_callee4);}));return _handleCheckUserPage.apply(this,arguments);}var text=props.tweet['content'];return/*#__PURE__*/_jsxs(\"article\",{className:\"tweet\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"left-side-tweet\",children:/*#__PURE__*/_jsx(\"img\",{src:author['profilePicture']===\"\"?DEFAULT_PP:author['profilePicture'],alt:\"author's profile\",height:\"60\",width:\"60\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"tweet-container\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"tweet-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"color-light-pink bold tweet-username \".concat(props.default?\"disabled-pointer\":\"pointer\"),onClick:props.default?undefined:handleCheckUserPage,children:author['username']}),/*#__PURE__*/_jsx(\"span\",{className:\"color-light-grey\",children:moment(props.tweet[\"dateCreated\"]).fromNow()})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"tweet-content\",children:[props.tweet['image']!==\"\"&&/*#__PURE__*/_jsx(\"img\",{className:\"tweet-image\",src:props.tweet['image'],alt:\"Not Found\",width:\"300px\"}),/*#__PURE__*/_jsx(AutoLink,{text:text,renderText:function renderText(txt){return/*#__PURE__*/_jsx(\"span\",{className:\"default-font\",children:txt});},renderLink:function renderLink(txt,match){return/*#__PURE__*/_jsx(CustomLink,{url:match.getAnchorHref(),msg:txt});}})]}),/*#__PURE__*/_jsxs(\"footer\",{className:\"tweet-footer\",children:[/*#__PURE__*/_jsx(TweetIcon,{default:props.default,onClick:props.default?undefined:undefined/*handleReplyChange*/,imageSrc:COMMENT_ICON,name:\"comments\",cpt:nbReplies[0],action:nbReplies[1]&&\"commented\"}),/*#__PURE__*/_jsx(TweetIcon,{default:props.default,onClick:props.default?undefined:handleRetweetChange,imageSrc:RETWEET_ICON,name:\"retweet\",cpt:nbRetweets[0],action:nbRetweets[1]&&\"retweeted\"}),/*#__PURE__*/_jsx(TweetIcon,{default:props.default,onClick:props.default?undefined:handleLikeChange,imageSrc:LIKE_ICON,name:\"like\",cpt:nbLikes[0],action:nbLikes[1]&&\"liked\"}),/*#__PURE__*/_jsx(TweetIcon,{default:props.default,imageSrc:SHARE_ICON,name:\"share\",cpt:0})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ride-side-tweet\",children:/*#__PURE__*/_jsx(\"input\",{className:\"tweet-del-res\",type:\"button\",value:\"Hide\",onClick:function onClick(event){return props.onDelete(event,handleDelete());}})})]});}","map":{"version":3,"sources":["/home/mrbigoudi/Documents/Projects/Birdy/birdy-client/src/components/Timeline/Tweet.js"],"names":["React","useState","AutoLink","useNavigate","axios","moment","CustomLink","TweetIcon","COMMENT_ICON","RETWEET_ICON","LIKE_ICON","SHARE_ICON","DEFAULT_PP","Tweet","props","nbReplies","tweet","nbRetweets","setNbRetweets","nbLikes","setNbLikes","deleted","setDeleted","navigate","get","then","res","setAuthor","data","author","handleDelete","event","prev","id","handleRetweetChange","preventDefault","userId","user","tweetId","put","handleLikeChange","Promise","all","post","handleCheckUserPage","state","alreadyLogged","replace","text","default","undefined","fromNow","txt","match","getAnchorHref","onDelete"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport AutoLink from \"react-native-autolink\";\nimport { useNavigate } from \"react-router-dom\";\nimport axios from \"axios\";\nimport moment from \"moment\";\n\nimport CustomLink from \"../../atomComponents/CustomLink.js\";\nimport TweetIcon from \"./TweetIcon.js\";\n\n\nimport COMMENT_ICON from \"../../images/icons/tweetIcons/outline_chat_bubble_outline_white_18dp_1x.png\";\nimport RETWEET_ICON from \"../../images/icons/tweetIcons/outline_reply_white_18dp_1x.png\";\nimport LIKE_ICON from \"../../images/icons/tweetIcons/outline_favorite_border_white_18dp_1x.png\";\nimport SHARE_ICON from \"../../images/icons/tweetIcons/outline_file_upload_white_18dp_1x.png\";\n\nimport DEFAULT_PP from \"../../images/icons/outline_account_circle_white_36dp_2x.png\";\n\nimport \"../../stylesheets/components/tweet.css\";\n\n\n//a tweet as a prop\nexport default function Tweet(props){\n\n    //const [nbReplies, setNbReplies] = useState([props.tweet['nbComments'], false]);\n    const nbReplies = props.tweet['nbComments'];\n    const [nbRetweets, setNbRetweets] = useState([props.tweet['nbRetweets'], false]);\n    const [nbLikes, setNbLikes] = useState([props.tweet['nbLikes'],false]);\n\n    const [deleted, setDeleted] = useState(props.deleted);\n    const navigate = useNavigate();\n\n    const [author, setAuthor] = useState(\n        async () => {\n            await axios\n                .get(`/api/user/${props.tweet['author']}`)\n                .then( (res) => {\n                    //console.log('user: ', res.data);\n                    setAuthor(res.data);\n                });\n        }\n    );\n\n    function handleDelete(event){\n        //console.log(\"handleDelete\");\n        setDeleted (prev => {\n            return !deleted;\n        })\n        return props.id;\n    }\n\n    // function handleReplyChange(event){\n    //     setNbReplies( prev => {\n    //         let replied = nbReplies[1]\n    //         if(!replied)\n    //             props.tweet.addReply();\n    //         else\n    //             props.tweet.removeReply();\n    //         return [props.tweet.getNbReplies(), !replied];\n    //     });\n    // }\n\n    async function handleRetweetChange(event){\n        event.preventDefault();\n        //console.log('tweet: ', props.tweet);\n        let userId = props.user['_id'];\n        let tweetId = props.tweet['_id'];\n        // await Promise.all([\n        //     axios\n        //         .get(`/api/user/getUserId/${props.user['username']}`)\n        //         .then( (res) => { userId = res.data; }),\n\n        //     axios\n        //         .post(\"/apiTweet/tweet/getTweetId\", props.tweet)\n        //         .then( (res) => { tweetId = res.data; }),\n        // ]);\n        //console.log('tweetId: ', tweetId);\n        //console.log('userId: ', userId);\n        //console.log('retweeted? ', nbRetweets[1]);\n        if(!nbRetweets[1]){\n            axios\n                .put(`/api/user/${userId}/tweet/${tweetId}/retweet`)\n                .then( () => {\n                    axios\n                        .get(`/apiTweet/tweet/${tweetId}`)\n                        .then( (res) => {\n                            //console.log('res last get: ', res);\n                            setNbRetweets( prev => {\n                                return [res.data['nbRetweets'], true];\n                        });\n                    });\n                });\n        } else {\n            axios\n                .put(`/api/user/${userId}/tweet/${tweetId}/unretweet`)\n                .then( () => {\n                    axios\n                        .get(`/apiTweet/tweet/${tweetId}`)\n                        .then( (res) => {\n                            //console.log('res last get: ', res);\n                            setNbRetweets( prev => {\n                                return [res.data['nbRetweets'], false];\n                        });\n                    });\n                });\n        }\n    }\n\n    async function handleLikeChange(event){\n        event.preventDefault();\n        //console.log('tweet: ', props.tweet);\n        let userId = '';\n        let tweetId = '';\n        await Promise.all([\n            axios\n                .get(`/api/user/getUserId/${props.user['username']}`)\n                .then( (res) => { userId = res.data; }),\n\n            axios\n                .post(\"/apiTweet/tweet/getTweetId\", props.tweet)\n                .then( (res) => { tweetId = res.data; }),\n        ]);\n        //console.log('tweetId: ', tweetId);\n        //console.log('userId: ', userId);\n        //console.log('liked? ', nbLikes[1]);\n        if(!nbLikes[1]){\n            axios\n                .put(`/api/user/${userId}/tweet/${tweetId}/like`)\n                .then( () => {\n                    axios\n                        .get(`/apiTweet/tweet/${tweetId}`)\n                        .then( (res) => {\n                            //console.log('res last get: ', res);\n                            setNbLikes( prev => {\n                                return [res.data['nbLikes'], true];\n                        });\n                    });\n                });\n        } else {\n            axios\n                .put(`/api/user/${userId}/tweet/${tweetId}/unlike`)\n                .then( () => {\n                    axios\n                        .get(`/apiTweet/tweet/${tweetId}`)\n                        .then( (res) => {\n                            //console.log('res last get: ', res);\n                            setNbLikes( prev => {\n                                return [res.data['nbLikes'], false];\n                        });\n                    });\n                });\n        }\n    }\n\n    async function handleCheckUserPage(event){\n        event.preventDefault();\n        //console.log('tweet: ', props.tweet);\n        let userId = props.user['_id'];\n        /*\n        await axios\n                .get(`/api/user/getUserId/${props.user['username']}`)\n                .then( (res) => { userId = res.data; });\n        */\n\n        const author = props.tweet['author'];\n        //console.log('test handle check user page');\n        if(author!==userId){\n            navigate(`/p/${userId}`, { state: { alreadyLogged: true, userId: author }, replace: false, });\n        }\n    }\n\n    const text = props.tweet['content'];\n\n\n    return(\n        <article className=\"tweet\">\n            <div className=\"left-side-tweet\">\n                <img src={author['profilePicture']===\"\" ? DEFAULT_PP : author['profilePicture']}\n                    alt=\"author's profile\"\n                    height=\"60\" width=\"60\"\n                />\n            </div>\n            <div className=\"tweet-container\">\n                <header className=\"tweet-header\">\n                    <span className={`color-light-pink bold tweet-username ${props.default? \"disabled-pointer\" : \"pointer\"}`}\n                        onClick={props.default? undefined : handleCheckUserPage}\n                    >\n                        {author['username']}\n                    </span>\n                    <span className=\"color-light-grey\">\n                        {moment(props.tweet[\"dateCreated\"]).fromNow()}\n                    </span>\n                </header>\n                <main className=\"tweet-content\">\n                    {props.tweet['image']!==\"\" && <img className=\"tweet-image\" src={props.tweet['image']} alt=\"Not Found\" width={\"300px\"} />}\n                    <AutoLink text={text} \n                        renderText={(txt) => <span className=\"default-font\">{txt}</span>}\n                        renderLink={(txt, match) => <CustomLink url={match.getAnchorHref()} msg={txt}/>}\n                    />\n                </main>\n                <footer className=\"tweet-footer\">\n                    <TweetIcon default={props.default} onClick={props.default? undefined : undefined/*handleReplyChange*/} imageSrc={COMMENT_ICON} \n                        name=\"comments\" cpt={nbReplies[0]} action={nbReplies[1] && \"commented\"}/>\n                    <TweetIcon default={props.default} onClick={props.default? undefined : handleRetweetChange} imageSrc={RETWEET_ICON} \n                        name=\"retweet\" cpt={nbRetweets[0]} action={nbRetweets[1] && \"retweeted\"}/>\n                    <TweetIcon default={props.default} onClick={props.default? undefined : handleLikeChange} imageSrc={LIKE_ICON} \n                        name=\"like\" cpt={nbLikes[0]} action={nbLikes[1] && \"liked\"}/>\n                    <TweetIcon default={props.default} imageSrc={SHARE_ICON} name=\"share\" cpt={0} />\n                </footer>\n            </div>\n            <div className=\"ride-side-tweet\">\n                <input className=\"tweet-del-res\" type=\"button\" value=\"Hide\" onClick={(event) => props.onDelete(event, handleDelete())} />\n            </div>\n        </article>\n    )\n}"]},"metadata":{},"sourceType":"module"}